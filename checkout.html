<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Checkout - Sucesso</title>
  <link rel="icon" href="images/sucesso fav icon.png" type="image/png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #ffffff;
      --text: #1a1a1a;
      --gray: #e5e5e5;
      --accent: #233f32;
      --right-bg: #f3f3f3;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

.loader {
      position: fixed;
      inset: 0;
      background-color: #ffffff;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 999999;
      opacity: 1;
      visibility: visible;
      transition: opacity 0.4s ease, visibility 0.4s ease;
    }

    .loader img {
      width: 120px;
      height: 120px;
      object-fit: contain;
      animation: zoomInClean 2s ease forwards;
    }

    @keyframes zoomInClean {
      0% { transform: scale(0.1); opacity: 0; }
      70% { transform: scale(1.1); opacity: 1; }
      100% { transform: scale(1); opacity: 1; }
    }

    
    header.navbar {
      position: fixed;
      top: 0;
      width: 100%;
      height: 70px;
      background-color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 0 20px;
      z-index: 1001;
      border-bottom: 1px solid #e5e5e5;
    }

    .logo {
      height: 35px;
      margin-top: 20px;
    }

    .checkout-wrapper {
      display: flex;
      max-width: 100%;
      margin-top: 70px;
      height: calc(100vh - 70px);
    }

    .form-section {
      flex: 1;
      padding: 2rem 4rem;
      overflow-y: scroll;
      height: 100%;
    }

    .summary-section {
      width: 50%;
      background: var(--right-bg);
      height: 100%;
      padding: 3rem 2rem;
      position: relative;
    }

    h2 {
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    label {
      display: block;
      margin-bottom: 0.3rem;
      font-weight: 500;
    }

    input, select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--gray);
      border-radius: 4px;
      font-size: 1rem;
    }

    .cart-item {
      display: flex;
      align-items: center;
      margin-bottom: 1rem;
    }

    .cart-item img {
  width: auto;
  height: 150px;
  object-fit: contain;
  border-radius: 2px;
  margin-right: 1rem;
  background-color: #e5e5e5e5;
}


    .cart-info {
      flex: 1;
    }

    .cart-info p {
      margin: 0;
      font-size: 0.9rem;
    }

    .price-section {
      text-align: right;
      margin-top: 1rem;
    }

    .price-section p {
      margin: 0.25rem 0;
      font-size: 0.95rem;
    }

    .total-section {
      margin-top: 1rem;
      font-size: 1.1rem;
      font-weight: 600;
      text-align: right;
    }

    button[type="submit"] {
  display: inline-block;
  background-color: transparent;
  color: #333;
  border: 1px solid #333;
  padding: 0.75rem 1.5rem;
  border-radius: 2px;
  font-weight: 600;
  font-size: 1rem;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  margin-top: 2rem;
  text-align: center;
}

button[type="submit"]:hover {
  background-color: #233f32;
  color: #ffffff;
}


    .form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
}

.form-row .form-group {
  margin-bottom: 1rem;
}

.accordion {
  border-radius: 6px;
  border: 1px solid #e5e5e5;
  overflow: hidden;
}

.accordion-item {
  border-bottom: 1px solid #e5e5e5;
}

.accordion-header {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  background: white;
  font-weight: 600;
  cursor: pointer;
}

.accordion-header input[type="radio"] {
  accent-color: var(--accent);
  width: 20px;
  height: 20px;
}

.accordion-panel {
  max-height: 0;
  overflow: hidden;
  opacity: 0;
  transition: all 0.3s ease;
  background: #fafafa;
  padding: 0 1rem;
}

.accordion-panel.open {
  max-height: 400px;
  opacity: 1;
  padding: 1rem;
}

.file-wrapper {
  margin-top: 0.75rem;
}

.file-wrapper label {
  font-weight: 500;
  display: block;
  margin-bottom: 0.3rem;
}

.file-wrapper input[type="file"] {
  border: 1px solid var(--gray);
  padding: 0.5rem;
  border-radius: 4px;
  width: 100%;
  background: white;
}

.file-upload {
  margin-top: 1rem;
}

.file-upload label {
  display: block;
  font-weight: 600;
  margin-bottom: 0.5rem;
  color: #333;
}

.upload-btn {
  display: inline-block;
  background-color: transparent;
      color: #333;
      border: 1px solid #333;
  padding: 0.4rem 1rem; /* más pequeño */
  border-radius: 2px;
  font-weight: 600;
  font-size: 0.85rem;    /* más chico también */
  cursor: pointer;
  transition: background-color 0.3s ease;
  position: relative;
  overflow: hidden;
  text-align: center;
  transition: all 0.3s ease;
}

.upload-btn:hover {
background-color: #233f32;
      color: #ffffff;
}



.file-name {
  margin-top: 0.5rem;
  font-size: 0.9rem;
  color: #666;
  display: block;
}

.label-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.envio-precio {
  font-weight: 600;
}

.pais-region-wrapper {
  position: relative;
}

/* Label flotante perfectamente dentro del borde */
.pais-region-wrapper label {
  position: absolute;
  top: 7px;
  left: 14px;
  background-color: white;
  padding: 0 4px;
  font-size: 0.75rem;
  color: #888;
  z-index: 2;
  pointer-events: none;
}

/* Select con apariencia nativa y padding ajustado */
.pais-region-wrapper select {
  background-color: white;
  color: #1a1a1a;
  font-weight: 400;
  width: 100%;
  padding: 1.75rem 0.75rem 0.75rem 0.75rem;
  border: 1px solid var(--gray);
  border-radius: 4px;
  font-size: 1rem;
  z-index: 1;
  appearance: auto; /* Esto mantiene la flecha del navegador */
}

/* Opciones internas iguales al select de Estado */
.pais-region-wrapper select option {
  background-color: white;
  color: #1a1a1a;
  font-weight: 400;
}

.custom-upload {
  display: flex;
  align-items: center;
  gap: 1rem;
}

.preview-container {
  position: relative;
  margin-top: 1rem;
  max-width: 300px;
}

.preview-img {
  width: 100%;
  height: auto;
  max-height: 300px;
  object-fit: contain;
  border-radius: 6px;
  display: none;
  background: #f0f0f0;
  padding: 4px;
}

.remove-preview {
  position: absolute;
  top: 4px;
  right: 8px;
  font-size: 18px;
  color: #333;
  cursor: pointer;
  font-weight: bold;
  z-index: 2;
}

@media (max-width: 768px) {
  .checkout-wrapper {
    flex-direction: column;
    height: auto;
  }

  .form-section {
    padding: 1rem;
    height: auto;
  }

  .summary-section {
    width: 100%;
    padding: 1rem;
    height: auto;
    order: -1; /* Para que el resumen aparezca arriba en móvil si lo deseas */
  }

  .cart-item {
    flex-direction: column;
    align-items: flex-start;
  }

  .cart-item img {
    width: 100%;
    height: auto;
    margin: 0 0 0.5rem 0;
  }

  .form-row {
    grid-template-columns: 1fr; /* Todos los inputs en una sola columna */
    gap: 0.5rem;
  }

  button[type="submit"] {
    padding: 1rem;
    font-size: 1.1rem;
  }

  .accordion-header {
    padding: 0.75rem;
  }

  .upload-btn {
    padding: 0.6rem 1rem;
    font-size: 1rem;
  }

  .preview-container {
    max-width: 100%;
  }
}

@media (max-width: 768px) {
  .summary-section {
    padding: 1rem;
  }

  .cart-item {
    flex-direction: row; /* Para que imagen + info estén lado a lado */
    align-items: center;
    gap: 0.75rem;
  }

  .cart-item img {
    width: 80px;  /* ajusta según lo veas bien */
    height: 80px;
    object-fit: contain;
    margin: 0;
    border-radius: 4px;
    background-color: #e5e5e5;
  }

  .cart-info {
    flex: 1;
  }

  .price-section {
    text-align: right;
    font-size: 0.95rem;
  }

  .total-section {
    font-size: 1rem;
    font-weight: bold;
  }
}

.mobile-order-summary {
  display: none;
  justify-content: space-between;
  align-items: center;
  padding: 1rem;
  border-bottom: 1px solid #e5e5e5;
  background: white;
  font-weight: 600;
  cursor: pointer;
  position: sticky;
  top: 70px;
  z-index: 1000;
}

.mobile-order-summary .summary-header {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.mobile-summary-content {
  max-height: 0;
  overflow: hidden;
  background: #f9f9f9;
  padding: 0 1rem;
  opacity: 0;
  transition: max-height 0.4s ease, opacity 0.4s ease, padding 0.4s ease;
}

.mobile-summary-content.open {
  max-height: 1000px; /* valor grande para que se expanda según el contenido */
  opacity: 1;
  padding: 1rem;
}


@media (max-width: 768px) {
  .mobile-order-summary {
    display: flex;
  }

  .summary-section {
    display: none;
  }
}

/* Documento con prefijo interno V/E (zona clicable mínima) */
.doc-wrapper {
  position: relative;
}

.doc-wrapper select#doc-prefix {
  position: absolute;
  left: 8px;
  top: 50%;
  transform: translateY(-50%);
  height: 70%;
  /* NUEVO: ancho controlado para que solo cubra la V/E */
  width: 2.8em;           /* suficiente para letra + caret nativo */
  min-width: 36px;        /* evita que se achique demasiado */
  max-width: 48px;        /* evita que se agrande en algunos navegadores */
  padding: 0;             /* sin padding extra */
  text-align: center;     /* centra la V/E */
  border: none;
  border-right: 1px solid var(--gray);
  background: transparent;
  font-size: 0.95rem;
  font-weight: 600;
  color: #233f32;
  outline: none;
  cursor: pointer;
  appearance: auto;       /* mantiene la flecha nativa */
  z-index: 2;             /* por encima del input solo en su ancho */
}

/* Deja espacio solo del ancho real del select */
.doc-wrapper input#documento-number {
  padding-left: 52px;     /* ajusta el espacio para que no se solape */
}

/* Ajuste en mobile para mantener el área reducida */
@media (max-width: 768px) {
  .doc-wrapper select#doc-prefix {
    height: 68%;
    width: 2.8em;
    min-width: 34px;
    max-width: 46px;
  }
  .doc-wrapper input#documento-number {
    padding-left: 50px;
  }
}

  /* ✅ Solo cuando el campo esté en foco (clic + escribiendo) */
  #discount-code:focus {
border: 2px solid #000 !important; /* grosor 2px y color negro */
  }

/* Estado inicial: deshabilitado */
#apply-discount-btn:disabled {
  background: #f5f5f5 !important;
  color: #999 !important;
  border: 1px solid #d9d9d9 !important;
  cursor: default !important;
  pointer-events: none !important; /* no recibe clics */
}

/* Estado habilitado */
#apply-discount-btn.enabled {
  background: #233f32 !important;
  border: 1px solid #233f32 !important;
  color: #fff !important;
  cursor: pointer !important;
  transition: all 0.3s ease;
  pointer-events: auto !important; /* vuelve a permitir clics */
}

/* Hover cuando está habilitado */
#apply-discount-btn.enabled:hover {
  background: #233f32 !important;
  color: #fff !important;
}

:root {
  --error: #b00020;
}

/* Borde rojo para error en el campo de descuento */
.discount-error {
  border: 2px solid var(--error) !important;
}


  </style>
</head>
<body>
    <div id="loader" class="loader">
    <img src="images/logo cherry png.png" alt="Sucesso Logo">
  </div>
  
  <header class="navbar">
    <a href="index.html"><img src="images/logo sucesso png.png" alt="Sucesso Logo" class="logo" /></a>
  </header>


<div class="mobile-order-summary" onclick="toggleMobileSummary()">
  <div class="summary-header">
    <span>Resumen del Pedido</span>
    <span id="summary-total">$0.00</span>
    <span id="summary-toggle">+</span>
  </div>
</div>
<div class="mobile-summary-content" id="mobile-summary-content">
  <!-- Esto se llenará dinámicamente con el mismo contenido del summary-section -->
</div>

  
  <div class="checkout-wrapper">
    <section class="form-section">
      <form id="checkout-form">
  <h2>Información de Contacto</h2>
  <div class="form-row">
    <div class="form-group">
      <input type="email" id="email" placeholder="Correo Electrónico" required>
    </div>
    <div class="form-group">
      <input type="tel" id="phone" placeholder="Teléfono" required>
    </div>
  </div>

  <h2>Entrega</h2>
<div class="form-group pais-region-wrapper">
  <label for="pais">País/Región</label>
  <select id="pais" required>
    <option value="Venezuela" selected>Venezuela</option>
  </select>
</div>

  <div class="form-row">
    <div class="form-group">
      <input type="text" id="nombre" placeholder="Nombre" required>
    </div>
    <div class="form-group">
      <input type="text" id="apellido" placeholder="Apellido" required>
    </div>
  </div>

<div class="form-group doc-wrapper">
  <select id="doc-prefix" aria-label="Tipo de documento">
    <option value="V" selected>V</option>
    <option value="E">E</option>
  </select>
  <input
    type="text"
    id="documento-number"
    placeholder="Número de Documento"
    inputmode="numeric"
    autocomplete="off"
    maxlength="10"
    required
  >
</div>


  <div class="form-group">
    <input type="text" id="direccion" placeholder="Dirección" required>
  </div>

  <div class="form-row">
    <div class="form-group">
      <input type="text" id="ciudad" placeholder="Ciudad" required>
    </div>
    <div class="form-group">
      <input type="text" id="municipio" placeholder="Municipio" required>
    </div>
  </div>

  <div class="form-row">
    <div class="form-group">
  <select id="estado" required>
    <option value="Capital" selected>Capital</option>
    <option value="Amazonas">Amazonas</option>
    <option value="Anzoátegui">Anzoátegui</option>
    <option value="Apure">Apure</option>
    <option value="Aragua">Aragua</option>
    <option value="Barinas">Barinas</option>
    <option value="Bolívar">Bolívar</option>
    <option value="Carabobo">Carabobo</option>
    <option value="Cojedes">Cojedes</option>
    <option value="Delta Amacuro">Delta Amacuro</option>
    <option value="Falcón">Falcón</option>
    <option value="Guárico">Guárico</option>
    <option value="Lara">Lara</option>
    <option value="Mérida">Mérida</option>
    <option value="Miranda">Miranda</option>
    <option value="Monagas">Monagas</option>
    <option value="Nueva Esparta">Nueva Esparta</option>
    <option value="Portuguesa">Portuguesa</option>
    <option value="Sucre">Sucre</option>
    <option value="Táchira">Táchira</option>
    <option value="Trujillo">Trujillo</option>
    <option value="Vargas">Vargas</option>
    <option value="Yaracuy">Yaracuy</option>
    <option value="Zulia">Zulia</option>
  </select>
</div>

    <div class="form-group">
  <input type="text" id="postal" placeholder="Código Postal (Opcional)">
</div>

  </div>

<h2>Métodos de Envío</h2>
<div class="accordion" id="envio-accordion">
  <div class="accordion-item">
    <label class="accordion-header">
  <input type="radio" name="metodo-envio" value="capital" data-costo="3.00" checked>
  <div class="label-content">
    <span>CAPITAL</span>
    <span class="envio-precio">$3.00</span>
  </div>
</label>
    <div class="accordion-panel">
      <p>Envío rápido dentro de la Capital. Tiempo estimado: 1-2 días hábiles.</p>
    </div>
  </div>

  <div class="accordion-item">
    <label class="accordion-header">
  <input type="radio" name="metodo-envio" value="resto" data-costo="0.00">
  <div class="label-content">
    <span>RESTO DE VENEZUELA</span>
    <span class="envio-precio">GRATIS</span>
  </div>
</label>
    <div class="accordion-panel">
      <p>El cliente será quien asume el costo de envío una vez retire su pedido en el MRW especificado</p>
    </div>
  </div>
</div>


<h2>Métodos de Pago</h2>

<div class="accordion">
  <div class="accordion-item">
    <label class="accordion-header">
      <input type="radio" name="metodo-pago" value="pago-movil" checked>
      <span>Pago Móvil</span>
    </label>
    <div class="accordion-panel">
  <p>Banco: Banco Nacional de Crédito<br>Número: 0424-1333923<br>Cédula: V-32904616<br>Nombre: Lian Beraja</p>
  <div class="file-upload">
  <label for="ref-pago-movil">Adjuntar referencia</label>
  <div class="custom-upload">
    <button type="button" class="upload-btn" onclick="document.getElementById('ref-pago-movil').click()">Seleccionar archivo</button>
<input type="file" id="ref-pago-movil" name="comprobante-pago-movil" accept="image/*" style="display: none;">
  </div>
  <div class="preview-container" id="container-pago-movil" style="display: none;">
    <span class="remove-preview" onclick="eliminarPreview('ref-pago-movil', 'preview-pago-movil', 'container-pago-movil')">x</span>
    <img class="preview-img" id="preview-pago-movil" alt="Preview" />
  </div>
</div>
  </div>
</div>



  <div class="accordion-item">
    <label class="accordion-header">
      <input type="radio" name="metodo-pago" value="transferencia">
      <span>Transferencia Bancaria Nacional</span>
    </label>
    <div class="accordion-panel">
  <p>
    Banco: Mercantil<br>
    Cuenta: 0105-1234-5678-9012-3456<br>
    Nombre: SUCESSO C.A.<br>
    RIF: J-12345678-9
  </p>
  <div class="file-upload">
  <label for="ref-transferencia">Adjuntar referencia</label>
  <div class="custom-upload">
    <button type="button" class="upload-btn" onclick="document.getElementById('ref-transferencia').click()">Seleccionar archivo</button>
    <input type="file" id="ref-transferencia" name="comprobante-transferencia" accept="image/*" style="display: none;">
  </div>
  <div class="preview-container" id="container-transferencia" style="display: none;">
    <span class="remove-preview" onclick="eliminarPreview('ref-transferencia', 'preview-transferencia', 'container-transferencia')">x</span>
    <img class="preview-img" id="preview-transferencia" alt="Preview" />
  </div>
</div>
  </div>
</div>


  <div class="accordion-item">
  <label class="accordion-header">
    <input type="radio" name="metodo-pago" value="paypal">
    <span>PayPal</span>
  </label>
  <div class="accordion-panel">
    <p>Email: pagos@sucesso.com<br>Moneda: USD</p>
    <div class="file-upload">
      <label for="ref-paypal">Adjuntar referencia</label>
      <div class="custom-upload">
        <button type="button" class="upload-btn" onclick="document.getElementById('ref-paypal').click()">Seleccionar archivo</button>
        <input type="file" id="ref-paypal" name="comprobante-paypal" accept="image/*" style="display: none;">
      </div>
      <div class="preview-container" id="container-paypal" style="display: none;">
        <span class="remove-preview" onclick="eliminarPreview('ref-paypal', 'preview-paypal', 'container-paypal')">x</span>
        <img class="preview-img" id="preview-paypal" alt="Preview" />
      </div>
    </div>
  </div>
</div>

<div class="accordion-item">
  <label class="accordion-header">
    <input type="radio" name="metodo-pago" value="zelle">
    <span>Zelle</span>
  </label>
  <div class="accordion-panel">
    <p>Email: zelle@sucesso.com<br>Nombre: SUCESSO C.A.</p>
    <div class="file-upload">
      <label for="ref-zelle">Adjuntar referencia</label>
      <div class="custom-upload">
        <button type="button" class="upload-btn" onclick="document.getElementById('ref-zelle').click()">Seleccionar archivo</button>
        <input type="file" id="ref-zelle" name="comprobante-zelle" accept="image/*" style="display: none;">
      </div>
      <div class="preview-container" id="container-zelle" style="display: none;">
        <span class="remove-preview" onclick="eliminarPreview('ref-zelle', 'preview-zelle', 'container-zelle')">x</span>
        <img class="preview-img" id="preview-zelle" alt="Preview" />
      </div>
    </div>
  </div>
</div>

  <div class="accordion-item">
    <label class="accordion-header">
      <input type="radio" name="metodo-pago" value="efectivo">
      <span>Pago en Efectivo</span>
    </label>
    <div class="accordion-panel">
      <p>El pago se realizará contra entrega.</p>
    </div>
  </div>
</div>


  <button type="submit">Confirmar Compra</button>
</form>

    </section>

    <section class="summary-section">
      <h2>Resumen del Pedido</h2>
      <div id="cart-items"></div>
      
<!-- DESCUENTO / GIFT CARD -->
<div class="discount-box" style="margin:16px 0;">
  <div style="display:flex; gap:8px; align-items:center;">
    <input id="discount-code" type="text" 
           placeholder="Código de descuento o tarjeta de regalo"
           style="flex:1; height:48px; padding:0 12px; border:1px solid #d9d9d9; border-radius:6px; font-size:14px; color:#333; outline:none;">
    <button id="apply-discount-btn" type="button"
            style="padding:0 16px; height:48px; border:1px solid #d9d9d9; background:#f5f5f5; color:#333; border-radius:6px; font-size:14px; font-weight:500; cursor:pointer;">
      Aplicar
    </button>
  </div>
  <div id="discount-msg" style="margin-top:8px; font-size:0.9rem; color:#233f32;"></div>
</div>

      <div class="price-section">
        <p><strong>Subtotal:</strong> <span id="subtotal-value">$0.00</span></p>
          <p><strong>Descuento:</strong> <span id="discount-value">-$0.00</span></p>
        <p><strong>Envío:</strong> <span id="envio-cost">$0.00</span></p>
      </div>
      <div class="total-section">
        Total: <span id="total-final">$0.00</span>
      </div>
    </section>
  </div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const discountInput = document.getElementById("discount-code");
    const applyBtn = document.getElementById("apply-discount-btn");

    // Deshabilitar inicialmente
    applyBtn.disabled = true;

    discountInput.addEventListener("input", () => {
      if (discountInput.value.trim().length > 0) {
        applyBtn.disabled = false;
        applyBtn.classList.add("enabled");
      } else {
        applyBtn.disabled = true;
        applyBtn.classList.remove("enabled");
      }
    });
  });
</script>

<script>
window.addEventListener("load", () => {
  const loader = document.getElementById("loader");
  setTimeout(() => {
    loader.style.opacity = "0";
    loader.style.visibility = "hidden";
    setTimeout(() => {
      loader.style.display = "none";
    }, 400); // Tiempo igual al transition del CSS
  }, 2500);
});
</script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {

        // --- Documento: permitir solo dígitos en el número ---
  const docNumberInput = document.getElementById("documento-number");
  docNumberInput.addEventListener("input", () => {
    // elimina todo lo que no sea dígito
    docNumberInput.value = docNumberInput.value.replace(/\D+/g, "");
  });

      const cartContainer = document.getElementById('cart-items');
      const subtotalValue = document.getElementById('subtotal-value');
      const totalFinal = document.getElementById('total-final');

      const carrito = JSON.parse(localStorage.getItem('carrito')) || [];
      let subtotal = 0;

      if (carrito.length === 0) {
        cartContainer.innerHTML = '<p>No hay productos en el carrito.</p>';
        return;
      }

      cartContainer.innerHTML = '';

      carrito.forEach(producto => {
        const nombre = producto.nombre || producto.name || 'Producto';
        const cantidad = producto.cantidad || producto.quantity || 1;
        const precioRaw = producto.precio || producto.price || "$0";
        const precio = typeof precioRaw === 'string' ? parseFloat(precioRaw.replace(/[^0-9.-]+/g, '')) : precioRaw;
        const imagen = producto.image || producto.imagen_frontal || 'images/default.jpg';

        const item = document.createElement('div');
        item.className = 'cart-item';
        item.innerHTML = `
          <img src="${imagen}" alt="${nombre}">
          <div class="cart-info">
            <p><strong>${nombre}</strong></p>
              <p>Talla: ${producto.size || 'Única'}</p>
            <p>Cantidad: ${cantidad}</p>
          </div>
          <div>
            $${(precio * cantidad).toFixed(2)}
          </div>
        `;

        cartContainer.appendChild(item);
        subtotal += precio * cantidad;
      });

      subtotalValue.textContent = `$${subtotal.toFixed(2)}`;
      totalFinal.textContent = `$${subtotal.toFixed(2)}`;
    });
  </script>

<script>
/* ============ CUPONES CONFIGURABLES ============

Edita/añade tus códigos aquí. Dos tipos:
- type: "percent" (valor en %)  | p.ej. 10 = 10%
- type: "fixed"   (valor en USD) | p.ej. 5  = $5.00

Opcionales:
- minSubtotal: mínimo de compra para aplicar
- expires: "YYYY-MM-DD" (UTC)   -> fecha límite inclusive
*/
const COUPONS = {
  "SUCESSO10": { type: "percent", value: 10,  minSubtotal: 0,  expires: "2030-12-31" },
  "LIAN":      { type: "fixed",   value: 50,   minSubtotal: 15, expires: "2030-12-31" },
  "SUCE550":   { type: "fixed",   value: 200,  minSubtotal: 0,  expires: "2030-12-31" },
  // agrega los tuyos aquí...
};

(function initDiscountSystem(){
  // Estado centralizado
  const desktopSummary  = document.querySelector(".summary-section");
  const mobileSummary   = document.getElementById("mobile-summary-content");

  // Intenta leer el subtotal ya renderizado por tu código
  const parseMoney = s => (parseFloat(String(s).replace(/[^0-9.-]+/g,'')) || 0);
  const fmt = n => `$${(n).toFixed(2)}`;

  // Guardamos valores maestros en window para reuso sin tocar tus scripts
  window.__checkoutState = window.__checkoutState || {
    subtotal: parseMoney(document.getElementById("subtotal-value")?.textContent || 0),
    shipping: parseMoney(document.querySelector('input[name="metodo-envio"]:checked')?.getAttribute("data-costo") || 0),
    discount: 0,
    code: null
  };

  // Helpers para seleccionar en desktop/móvil sin chocar IDs clonados
  const $d = sel => desktopSummary?.querySelector(sel);
  const $m = sel => mobileSummary?.querySelector(sel);

  function renderTotals(){
    const st  = window.__checkoutState;
    // corrige si por alguna razón cambió el subtotal ya pintado por tus scripts
    st.subtotal = parseMoney($d("#subtotal-value")?.textContent || st.subtotal);

    const maxDiscount = Math.min(st.discount, st.subtotal); // jamás más que el subtotal
    const total = st.subtotal - maxDiscount + st.shipping;

    // Desktop
    if ($d("#discount-value")) $d("#discount-value").textContent = `-$${maxDiscount.toFixed(2)}`;
    if ($d("#envio-cost"))     $d("#envio-cost").textContent     = fmt(st.shipping);
    if ($d("#total-final"))    $d("#total-final").textContent    = fmt(total);

    // Mobile (los mismos IDs existen dentro del contenedor clonado)
    if ($m("#discount-value")) $m("#discount-value").textContent = `-$${maxDiscount.toFixed(2)}`;
    if ($m("#envio-cost"))     $m("#envio-cost").textContent     = fmt(st.shipping);
    if ($m("#total-final"))    $m("#total-final").textContent    = fmt(total);

    const headerTotal = document.getElementById("summary-total");
    if (headerTotal) headerTotal.textContent = fmt(total);
  }

  function readShipping(){
    const checked = document.querySelector('input[name="metodo-envio"]:checked');
    window.__checkoutState.shipping = parseMoney(checked?.getAttribute("data-costo") || 0);
  }

  function validateAndComputeDiscount(code){
    if (!code) return {ok:false, msg:"Ingresa un código."};
    const c = COUPONS[code.trim().toUpperCase()];
    if (!c) return {ok:false, msg:"Código inválido o vencido."};

    // vencimiento
    if (c.expires) {
      const today = new Date(); today.setHours(0,0,0,0);
      const exp = new Date(c.expires+"T00:00:00Z");
      if (today.getTime() > exp.getTime()) return {ok:false, msg:"El código está vencido."};
    }

    // mínimo
    const st = window.__checkoutState;
    if (c.minSubtotal && st.subtotal < c.minSubtotal) {
      return {ok:false, msg:`Mínimo de compra: $${c.minSubtotal.toFixed(2)}.`};
    }

    // valor
    let discount = 0;
    if (c.type === "percent") discount = st.subtotal * (c.value/100);
    else if (c.type === "fixed") discount = c.value;
    discount = Math.max(0, Math.min(discount, st.subtotal)); // cap

    return {ok:true, discount, meta:c};
  }

  function attachBox(scope){
    if (!scope) return;
    const codeInput = scope.querySelector("#discount-code");
    const btn       = scope.querySelector("#apply-discount-btn");
    const msgEl     = scope.querySelector("#discount-msg");
    if (!codeInput || !btn) return;

    // 🔴/✅ Helper para controlar el borde rojo de error
    const setErrorBorder = (on) => {
      if (on) codeInput.classList.add("discount-error");
      else codeInput.classList.remove("discount-error");
    };

    // ⛔️ Evitar re-habilitar si ya se aplicó (aunque otros scripts intenten)
    codeInput.addEventListener("input", () => {
      if (btn.dataset.locked === "1") {
        // mantener limpio y bloqueado
        codeInput.value = "";
        btn.disabled = true;
        btn.classList.remove("enabled");
      }
    });

    const apply = () => {
      const code = codeInput.value.trim();
      const res = validateAndComputeDiscount(code);

      msgEl && (msgEl.style.color = res.ok ? "#0b7a5c" : "#b00020");

      if (!res.ok){
        setErrorBorder(true);
        window.__checkoutState.discount = 0;
        window.__checkoutState.code = null;
        if (msgEl) msgEl.textContent = res.msg;
        renderTotals();
        return;
      }

      // ✅ Código correcto: aplicar descuento
      setErrorBorder(false);
      window.__checkoutState.discount = res.discount;
      window.__checkoutState.code = code.toUpperCase();
      if (msgEl) msgEl.textContent = `Código aplicado: ${window.__checkoutState.code} (-${fmt(res.discount)})`;
      renderTotals();

      // 🔒 NUEVO: limpiar input y bloquear botón definitivamente en esta sesión
      codeInput.value = "";
      btn.disabled = true;
      btn.classList.remove("enabled");
      btn.dataset.locked = "1";
    };

    btn.addEventListener("click", apply);
    codeInput.addEventListener("keydown", (e)=>{ if (e.key === "Enter") { e.preventDefault(); apply(); }});
  }

  // Envío cambia: recalculamos después de tus listeners
  document.querySelectorAll('input[name="metodo-envio"]').forEach(r=>{
    r.addEventListener("change", ()=>{ readShipping(); renderTotals(); });
  });

  // Estado inicial
  readShipping();
  renderTotals();

  // Conectar cajas (desktop y móvil)
  attachBox(desktopSummary);
  attachBox(mobileSummary);

  // Exponer para que otros scripts puedan forzar un repaint si cambian algo
  window.__renderTotalsWithDiscount = renderTotals;

  // Permite re-vincular la caja de descuento en el contenedor móvil tras el clonado
  window.__rebindDiscountBox = () => {
    const mobile = document.getElementById("mobile-summary-content");
    if (mobile) {
      if (mobile.querySelector("#discount-code") && mobile.querySelector("#apply-discount-btn")) {
        (function(scope){
          const codeInput = scope.querySelector("#discount-code");
          const btn = scope.querySelector("#apply-discount-btn");
          const msgEl = scope.querySelector("#discount-msg");
          if (!codeInput || !btn) return;

          const setErrorBorder = (on) => {
            if (on) codeInput.classList.add("discount-error");
            else codeInput.classList.remove("discount-error");
          };

          // ⛔️ Mantener bloqueo en móvil también
          codeInput.addEventListener("input", () => {
            if (btn.dataset.locked === "1") {
              codeInput.value = "";
              btn.disabled = true;
              btn.classList.remove("enabled");
            }
          });

          const apply = () => {
            const code = codeInput.value.trim();
            const res = (typeof validateAndComputeDiscount === "function")
              ? validateAndComputeDiscount(code)
              : (window.validateAndComputeDiscount && window.validateAndComputeDiscount(code));
            if (!res) return;

            msgEl && (msgEl.style.color = res.ok ? "#0b7a5c" : "#b00020");

            if (!res.ok){
              setErrorBorder(true);
              window.__checkoutState.discount = 0;
              window.__checkoutState.code = null;
              if (msgEl) msgEl.textContent = res.msg;
              window.__renderTotalsWithDiscount?.();
              return;
            }

            setErrorBorder(false);
            window.__checkoutState.discount = res.discount;
            window.__checkoutState.code = code.toUpperCase();
            if (msgEl) msgEl.textContent = `Código aplicado: ${code.toUpperCase()} (-${fmt(res.discount)})`;
            window.__renderTotalsWithDiscount?.();

            // 🔒 NUEVO: limpiar input y bloquear botón definitivamente en esta sesión
            codeInput.value = "";
            btn.disabled = true;
            btn.classList.remove("enabled");
            btn.dataset.locked = "1";
          };

          btn.onclick = apply;
          codeInput.onkeydown = (e)=>{ if (e.key === "Enter") { e.preventDefault(); apply(); }};
        })(mobile);
      }
    }
  };
})();
</script>



<script>
  document.addEventListener('DOMContentLoaded', () => {
    const envioRadios = document.querySelectorAll('input[name="metodo-envio"]');

    function toggleEnvioPanels() {
      document.querySelectorAll('#envio-accordion .accordion-panel').forEach(panel => {
        panel.classList.remove('open');
      });

      const selected = document.querySelector('#envio-accordion input[name="metodo-envio"]:checked');
      if (selected) {
        const panel = selected.closest('.accordion-item').querySelector('.accordion-panel');
        panel.classList.add('open');
      }
    }

    envioRadios.forEach(radio => {
      radio.addEventListener('change', toggleEnvioPanels);
    });

    toggleEnvioPanels(); // Ejecutar al cargar
  });
</script>


<script>
  function mostrarPreview(inputFile, previewId, containerId) {
    const preview = document.getElementById(previewId);
    const container = document.getElementById(containerId);
    if (inputFile.files && inputFile.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        preview.src = e.target.result;
        preview.style.display = "block";
        container.style.display = "block";
      };
      reader.readAsDataURL(inputFile.files[0]);
    }
  }

  function eliminarPreview(inputId, previewId, containerId) {
    document.getElementById(inputId).value = "";
    document.getElementById(previewId).src = "";
    document.getElementById(previewId).style.display = "none";
    document.getElementById(containerId).style.display = "none";
  }

document.getElementById("ref-pago-movil").addEventListener("change", function () {
    mostrarPreview(this, "preview-pago-movil", "container-pago-movil");
  });

  document.getElementById("ref-transferencia").addEventListener("change", function () {
    mostrarPreview(this, "preview-transferencia", "container-transferencia");
  });

  document.getElementById("ref-paypal").addEventListener("change", function () {
    mostrarPreview(this, "preview-paypal", "container-paypal");
  });

  document.getElementById("ref-zelle").addEventListener("change", function () {
    mostrarPreview(this, "preview-zelle", "container-zelle");
  });
</script>

<script>
  document.getElementById('estado').addEventListener('change', () => {
    const estado = document.getElementById('estado').value;
    if (estado === 'Capital') {
      document.querySelector('input[name="metodo-envio"][value="capital"]').checked = true;
    } else {
      document.querySelector('input[name="metodo-envio"][value="resto"]').checked = true;
    }

    // Forzar reapertura de panel correcto
    const evento = new Event('change');
    document.querySelector('input[name="metodo-envio"]:checked').dispatchEvent(evento);
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const envioRadios = document.querySelectorAll('input[name="metodo-envio"]');
    const subtotalElement = document.getElementById("subtotal-value");
    const envioCostElement = document.getElementById("envio-cost");
    const totalFinalElement = document.getElementById("total-final");

    let subtotal = 0;

// Obtener subtotal inicial desde HTML
if (subtotalElement) {
  subtotal = parseFloat(subtotalElement.textContent.replace('$', '')) || 0;
}

function actualizarTotal() {
  const envioSeleccionado = document.querySelector('input[name="metodo-envio"]:checked');
  const costoEnvio = parseFloat(envioSeleccionado.getAttribute('data-costo')) || 0;

  envioCostElement.textContent = `$${costoEnvio.toFixed(2)}`;
  totalFinalElement.textContent = `$${(subtotal + costoEnvio).toFixed(2)}`;

  // ⬇️ Forzar que el total respete el descuento aplicado
  window.__renderTotalsWithDiscount && window.__renderTotalsWithDiscount();
}

envioRadios.forEach(radio => {
  radio.addEventListener('change', actualizarTotal);
});

actualizarTotal(); // Ejecutar al cargar

// ⬇️ También tras el primer cálculo, por si ya había cupón aplicado
window.__renderTotalsWithDiscount && window.__renderTotalsWithDiscount();

  });
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const subtotalEl = document.getElementById("subtotal-value");
  const envioCostEl = document.getElementById("envio-cost");
  const totalFinalEl = document.getElementById("total-final");
  const summaryTotalEl = document.getElementById("summary-total");
  
  let subtotal = parseFloat(subtotalEl.textContent.replace("$", "")) || 0;

  function actualizarResumen() {
    const envioSeleccionado = document.querySelector('input[name="metodo-envio"]:checked');
    const costoEnvio = parseFloat(envioSeleccionado?.getAttribute("data-costo")) || 0;

    // Actualizar valores en desktop
    envioCostEl.textContent = `$${costoEnvio.toFixed(2)}`;
    totalFinalEl.textContent = `$${(subtotal + costoEnvio).toFixed(2)}`;

    // Actualizar valores en mobile summary
    const mobileSummary = document.getElementById("mobile-summary-content");
    if (mobileSummary) {
      const envioSpan = mobileSummary.querySelector("#envio-cost");
      const totalSpan = mobileSummary.querySelector("#total-final");
      if (envioSpan) envioSpan.textContent = `$${costoEnvio.toFixed(2)}`;
      if (totalSpan) totalSpan.textContent = `$${(subtotal + costoEnvio).toFixed(2)}`;
    }

    // Actualizar el resumen header móvil
    summaryTotalEl.textContent = `$${(subtotal + costoEnvio).toFixed(2)}`;
  }

  // Escuchar cambios de método de envío
  document.querySelectorAll('input[name="metodo-envio"]').forEach(radio => {
    radio.addEventListener("change", actualizarResumen);
  });

  // Escuchar cambio de estado
  document.getElementById("estado").addEventListener("change", () => {
    const estado = document.getElementById("estado").value;
    if (estado === "Capital") {
      document.querySelector('input[name="metodo-envio"][value="capital"]').checked = true;
    } else {
      document.querySelector('input[name="metodo-envio"][value="resto"]').checked = true;
    }
    actualizarResumen();
  });

  // Inicializar
  actualizarResumen();
});
</script>

  
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, addDoc, collection, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyD3u2GKMSAKC_1Cd88KA-rxTOf_Jnt3fuM",
  authDomain: "sucesso-74f7c.firebaseapp.com",
  projectId: "sucesso-74f7c",
  storageBucket: "sucesso-74f7c.appspot.com",
  messagingSenderId: "878844661636",
  appId: "1:878844661636:web:6382f86f18201aecfdd7d1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

let currentUser = null;

// Verificar sesión activa al cargar
onAuthStateChanged(auth, (user) => {
  if (user) {
    currentUser = user;
  } else {
    currentUser = null;
  }
});

document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById("checkout-form");

    // Referencias del documento (en este scope del módulo)
  const docNumberInput = document.getElementById("documento-number");
  const docPrefixSel = document.getElementById("doc-prefix");


  // MÉTODOS DE PAGO - abrir/cerrar paneles
  const metodoPagoRadios = document.querySelectorAll('input[name="metodo-pago"]');
  function togglePagoPanels() {
    document.querySelectorAll('.accordion .accordion-panel').forEach(panel => {
      panel.classList.remove('open');
    });
    const selected = document.querySelector('input[name="metodo-pago"]:checked');
    if (selected) {
      const panel = selected.closest('.accordion-item').querySelector('.accordion-panel');
      panel.classList.add('open');
    }
  }
  metodoPagoRadios.forEach(radio => {
    radio.addEventListener('change', togglePagoPanels);
  });
  togglePagoPanels();

  // SUBMIT DEL FORMULARIO
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    let valid = true;

    // Validar campos obligatorios
    form.querySelectorAll("[required]").forEach(input => {
      if (!input.value.trim()) {
        input.reportValidity();
        valid = false;
      }
    });

        // Validar documento (solo números 5–10) + prefijo V/E
    const docPrefixSel = document.getElementById("doc-prefix");
    const docNumber = docNumberInput.value.trim();
    const onlyDigits = /^\d{5,10}$/;

    if (!onlyDigits.test(docNumber)) {
      docNumberInput.setCustomValidity("Ingresa solo números (5 a 10 dígitos).");
      docNumberInput.reportValidity();
      valid = false;
    } else {
      docNumberInput.setCustomValidity("");
    }

        // Si algo está inválido, corta aquí
    if (!valid) return;


        // Validar comprobantes
const metodoPago = document.querySelector('input[name="metodo-pago"]:checked')?.value;

if (metodoPago === "pago-movil" && !document.getElementById("ref-pago-movil").files.length) {
  alert("Debes subir el comprobante de Pago Móvil.");
  return;
}
if (metodoPago === "transferencia" && !document.getElementById("ref-transferencia").files.length) {
  alert("Debes subir el comprobante de Transferencia.");
  return;
}
if (metodoPago === "paypal" && !document.getElementById("ref-paypal").files.length) {
  alert("Debes subir el comprobante de PayPal.");
  return;
}
if (metodoPago === "zelle" && !document.getElementById("ref-zelle").files.length) {
  alert("Debes subir el comprobante de Zelle.");
  return;
}


    // Verificar carrito
    const carrito = JSON.parse(localStorage.getItem("carrito")) || [];
    if (!carrito.length) {
      alert("Tu carrito está vacío.");
      return;
    }

    // Verificar usuario
    const user = auth.currentUser;
if (!user) {
  alert("Debes iniciar sesión para confirmar tu compra.");
  window.location.href = "login.html";
  return;
}


// Preparar datos
const envio = document.querySelector('input[name="metodo-envio"]:checked');
const envioCosto = parseFloat(envio.getAttribute("data-costo")) || 0;

// LEER descuento aplicado desde el estado global del cupón
const appliedDiscount = (window.__checkoutState?.discount || 0);
const appliedCode     = (window.__checkoutState?.code || null);

const subtotal = carrito.reduce((sum, p) => {
  const precioNum = typeof p.price === "number"
    ? p.price
    : parseFloat(String(p.price ?? p.precio ?? 0).replace(/[^0-9.-]+/g, "")) || 0;
  const cantNum = typeof p.quantity === "number" ? p.quantity : parseInt(p.quantity ?? p.cantidad ?? 1, 10) || 1;
  return sum + precioNum * cantNum;
}, 0);

// TOTAL FINAL RESPETANDO DESCUENTO (nunca negativo)
const total = Math.max(0, subtotal - appliedDiscount) + envioCosto;

const docFull = `${(docPrefixSel.value || "V").toUpperCase()}-${docNumber}`;
const datosCompra = {
  uid: user.uid,
  email: document.getElementById("email").value,
  telefono: document.getElementById("phone").value,
  nombre: document.getElementById("nombre").value,
  apellido: document.getElementById("apellido").value,
  documento: docFull,
  direccion: document.getElementById("direccion").value,
  ciudad: document.getElementById("ciudad").value,
  municipio: document.getElementById("municipio").value,
  estado: document.getElementById("estado").value,
  postal: document.getElementById("postal").value,
  metodo_envio: envio.value,
  metodo_pago: metodoPago,
  items: carrito.map(p => ({
    nombre: p.name || p.nombre || "Producto",
    cantidad: p.quantity || p.cantidad || 1,
    precio: p.price || p.precio || 0,
    talla: p.size || p.talla || "Única"
  })),
  subtotal,
  envio: envioCosto,
  // NUEVO:
  descuento: appliedDiscount,
  codigo_descuento: appliedCode,
  total,
  fecha: serverTimestamp()
};



try {
  await addDoc(collection(db, "compras"), datosCompra);

  await emailjs.send("service_8yvqy7r", "template_id2awis", {
  nombre: datosCompra.nombre || 'N/A',
  apellido: datosCompra.apellido || 'N/A',
  email: datosCompra.email || 'N/A',
  telefono: datosCompra.telefono || 'N/A',
  documento: datosCompra.documento || 'N/A',
  direccion: datosCompra.direccion || 'N/A',
  ciudad: datosCompra.ciudad || 'N/A',
  municipio: datosCompra.municipio || 'N/A',
  estado: datosCompra.estado || 'N/A',
  postal: datosCompra.postal || 'N/A',
  metodo_envio: datosCompra.metodo_envio || 'N/A',
  metodo_pago: datosCompra.metodo_pago || 'N/A',
  subtotal: datosCompra.subtotal?.toFixed(2) || '0.00',
  envio: datosCompra.envio?.toFixed(2) || '0.00',
  total: datosCompra.total?.toFixed(2) || '0.00',
  fecha: new Date().toLocaleString(),
  items_html: datosCompra.items.map(i =>
  `<tr>
    <td style="padding:8px; border-bottom:1px solid #eee;">${i.cantidad}</td>
    <td style="padding:8px; border-bottom:1px solid #eee;">${i.nombre}</td>
    <td style="padding:8px; border-bottom:1px solid #eee;">${i.talla}</td>
    <td style="padding:8px; border-bottom:1px solid #eee; text-align:right;">$${i.precio.toFixed(2)}</td>
  </tr>`
).join(""),


});


  localStorage.removeItem("carrito");
  window.location.href = "thank-you.html";

} catch (err) {
  console.error("Error al guardar compra:", err);
  alert("Hubo un error al registrar la compra. Intenta de nuevo.");
}

  });
});
</script>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  window.onload = function () {
    emailjs.init("ZBp0ewAzqXPihpO94"); // Tu USER ID
  };
</script>

<script>
function toggleMobileSummary() {
  const content = document.getElementById("mobile-summary-content");
  const toggleIcon = document.getElementById("summary-toggle");

  if (content.classList.contains("open")) {
    content.classList.remove("open");
    toggleIcon.textContent = "+";
  } else {
    content.classList.add("open");
    toggleIcon.textContent = "−";
  }
}

document.addEventListener("DOMContentLoaded", () => {
  // Copiar el contenido de la summary-section al resumen móvil
  const summaryHTML = document.querySelector(".summary-section").innerHTML;
  document.getElementById("mobile-summary-content").innerHTML = summaryHTML;
// Re-vincular listeners del cupón en el contenedor móvil
window.__rebindDiscountBox && window.__rebindDiscountBox();


  // Actualizar el total
  const total = document.getElementById("total-final").textContent;
  document.getElementById("summary-total").textContent = total;
});
</script>

  
</body>
</html>
